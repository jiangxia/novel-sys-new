# 小说创作系统 - Requirements Document

基于AI驱动的本地化小说创作平台，集成PromptX MCP和4角色AI系统

## Core Features

### 1. 本地项目文件管理
- 用户选择本地小说创作项目目录
- 严格验证4目录结构：`0-小说设定/`、`1-故事大纲/`、`2-故事概要/`、`3-小说内容/`
- 项目文件树展示和文件编辑功能

### 2. 双栏布局界面
- 左侧：AI对话区 + 项目文件Tab切换
- 右侧：Monaco文件编辑器 + 文件标签管理
- 响应式布局支持移动端访问

### 3. 4角色AI系统 (基于PromptX MCP)
- **架构师**：专注世界观设定 (`0-小说设定/`)
- **规划师**：专注故事结构 (`1-故事大纲/`、`2-故事概要/`)
- **写手**：专注内容创作 (`3-小说内容/`)
- **总监**：全局统筹和协调

### 4. 自动角色路由
- 根据用户编辑的文件类型自动切换对应AI角色
- 手动角色切换功能

### 5. PromptX MCP集成
- 通过PromptX CLI的MCP Server连接大模型(Gemini)
- 使用`promptx_action`激活角色提示词
- 基于`.promptx/resource/role/`目录的角色文件系统

## User Stories

### 小说作者用户
- As a 小说作者, I want 选择本地项目目录, so that 系统可以验证我的项目结构是否正确
- As a 小说作者, I want 在右侧编辑文件内容, so that 我可以修改小说的各个部分
- As a 小说作者, I want 系统自动切换对应的AI角色, so that 我能得到针对性的创作建议
- As a 小说作者, I want 与AI角色对话, so that 我能获得专业的小说创作指导

### AI角色专家
- As an AI架构师, I want 分析世界观设定文件, so that 我能提供世界观构建建议
- As an AI规划师, I want 分析大纲和概要文件, so that 我能提供故事结构优化建议
- As an AI写手, I want 分析小说内容文件, so that 我能提供文笔和情节建议
- As an AI总监, I want 统筹全局, so that 我能提供整体协调和质量控制建议

## Acceptance Criteria

### 项目文件管理
- [ ] 用户可以通过前端界面选择本地项目目录
- [ ] 系统验证4个必需目录存在：`0-小说设定/`、`1-故事大纲/`、`2-故事概要/`、`3-小说内容/`
- [ ] 缺少目录时显示错误提示和修正建议
- [ ] 项目文件以树形结构展示
- [ ] 点击文件可在右侧Monaco编辑器中打开

### AI对话系统
- [ ] 成功集成Gemini大模型API
- [ ] PromptX CLI正确安装和配置
- [ ] MCP Server可以正常启动和连接
- [ ] 4个AI角色的提示词文件正确放置在`.promptx/resource/role/`目录
- [ ] `promptx_action`可以成功激活不同角色
- [ ] AI响应速度在3秒内

### 自动角色路由
- [ ] 编辑`0-小说设定/`下文件时自动切换到架构师
- [ ] 编辑`1-故事大纲/`或`2-故事概要/`下文件时自动切换到规划师  
- [ ] 编辑`3-小说内容/`下文件时自动切换到写手
- [ ] 用户可以手动切换到任意角色
- [ ] 角色切换时显示系统提示消息

### 用户界面
- [ ] 左侧Tab可以在"对话"和"项目文件"之间切换
- [ ] 右侧支持多文件标签编辑
- [ ] 文件修改状态正确显示
- [ ] 移动端响应式布局正常工作
- [ ] 汉堡菜单可以收起/展开侧边栏

## Non-functional Requirements

### 性能要求
- AI响应时间 < 3秒
- 前端页面加载时间 < 2秒
- 文件编辑器响应时间 < 100ms
- MCP连接建立时间 < 5秒

### 兼容性要求
- 支持Chrome 100+, Firefox 100+, Safari 14+
- 支持桌面端和移动端设备
- 支持Node.js 18+环境
- 兼容PromptX CLI最新稳定版

### 可靠性要求
- MCP连接成功率 > 95%
- 系统无崩溃运行时间 > 24小时
- 文件保存成功率 > 99%
- 错误情况下优雅降级

### 安全要求
- API密钥安全存储在环境变量中
- 用户文件仅在本地处理，不上传到服务器
- CORS正确配置，防止跨域攻击
- 输入验证和防止注入攻击

### 可维护性要求
- 代码模块化，职责清晰分离
- 完整的错误处理和日志记录
- 易于添加新的AI角色
- 支持Docker容器化部署
