# 小说创作系统 - 任务分解

**基于现有 workflow.json，严格按照已完成的开发进度制定后续任务**

## 项目当前状态

### ✅ 已完成阶段
- **Phase-1: 需求与设计** (100% 完成)
- **Phase-2: 前端开发** (100% 完成 - 10个任务)
- **task-3-1: Node.js服务器搭建** (已完成)

### 🔄 当前阶段: Phase-3 Gemini大模型集成
**下一步任务**: task-3-2 Gemini API配置和连接测试

---

## Phase-3: Gemini大模型集成 (进行中)

### Task 3-2: Gemini API配置和连接测试 ✅
**状态**: completed
**优先级**: high
**预估工作量**: 3小时
**依赖**: task-3-1 (已完成)

#### 具体实现步骤
1. **配置Gemini API密钥**
   - 在后端 `.env` 文件中添加 `GEMINI_API_KEY`
   - 验证API Key有效性: `AIzaSyAU6hw8DQTDu8DmJYQi6Dcp-qljAAGdFuw`

2. **创建LLM Client**
   - 安装 `@google/generative-ai` SDK
   - 创建 `services/geminiService.js`
   - 实现基础的模型初始化和连接测试

3. **测试大模型调用**
   - 编写简单的测试接口 `/api/test/gemini`
   - 验证模型响应正常
   - 测试中文对话能力

#### 验收标准
- [x] Gemini API密钥正确配置
- [x] 模型初始化成功
- [x] 测试接口返回正常响应
- [x] 支持中文对话

### Task 3-3: 基础AI对话接口开发 ✅
**状态**: completed
**优先级**: high
**预估工作量**: 2小时
**依赖**: task-3-2

#### 具体实现步骤
1. **实现基础对话API**
   - 创建 `POST /api/ai/chat` 接口
   - 接收用户消息，调用Gemini API
   - 返回AI响应

2. **错误处理**
   - API调用失败处理
   - 超时处理
   - 用户友好的错误提示

#### 验收标准
- [x] `/api/ai/chat` 接口工作正常
- [x] 支持消息发送和响应
- [x] 完整的错误处理机制

---

## Phase-4: MCP基础设施 (计划中)

### Task 4-1: MCP SDK集成
**预估工作量**: 2小时

#### 实现步骤
1. 安装MCP SDK: `npm install @modelcontextprotocol/sdk`
2. 创建基础MCP Client架构
3. 建立MCP客户端连接模板

### Task 4-2: MCP连接机制建立
**预估工作量**: 3小时
**依赖**: task-4-1

#### 实现步骤
1. 建立MCP协议通信
2. 验证JSON-RPC 2.0调用
3. 测试MCP服务器连接

---

## Phase-5: PromptX MCP集成 (计划中)

### Task 5-1: PromptX CLI安装和配置
**预估工作量**: 2小时

#### 实现步骤
1. 安装PromptX CLI工具
2. 配置MCP Server启动脚本
3. 验证PromptX命令行工具可用性

### Task 5-2: PromptX工具验证
**预估工作量**: 3小时
**依赖**: task-5-1

#### 实现步骤
1. 验证`promptx_action`等工具可用性
2. 测试MCP调用功能
3. 集成PromptX到后端服务

---

## Phase-6: AI角色系统 (计划中)

### Task 6-1: 角色提示词集成
**预估工作量**: 3小时

#### 实现步骤
1. 集成4个角色提示词（架构师、规划师、写手、总监）
2. 实现角色激活功能
3. 建立角色提示词管理机制

### Task 6-2: 角色切换和路由
**预估工作量**: 2小时
**依赖**: task-6-1

#### 实现步骤
1. 实现角色切换逻辑
2. 实现自动路由功能（基于文件类型）
3. 前后端角色状态同步

---

## Phase-7: 系统集成与测试 (最终阶段)

### Task 7-1: 前后端AI对话联调
**预估工作量**: 3小时

#### 实现步骤
1. 连接前端AI对话界面与后端AI功能
2. 实现完整的消息发送/接收流程
3. 测试4个AI角色的对话功能

### Task 7-2: 自动角色路由测试
**预估工作量**: 2小时
**依赖**: task-7-1

#### 实现步骤
1. 测试文件编辑时的自动角色切换
2. 验证角色路由规则：
   - `0-小说设定/` → 架构师
   - `1-故事大纲/` → 规划师
   - `2-故事概要/` → 规划师
   - `3-小说内容/` → 写手

### Task 7-3: 整体功能验证
**预估工作量**: 2小时
**依赖**: task-7-2

#### 实现步骤
1. 完整用户流程测试
2. Bug修复和优化
3. MVP功能验收

---

## 项目里程碑

| 阶段 | 状态 | 完成任务数 | 总任务数 | 完成率 |
|------|------|-----------|----------|--------|
| Phase-1: 需求与设计 | ✅ 完成 | 3 | 3 | 100% |
| Phase-2: 前端开发 | ✅ 完成 | 10 | 10 | 100% |
| Phase-3: Gemini集成 | 🔄 进行中 | 1 | 3 | 33% |
| Phase-4: MCP基础设施 | ⏳ 计划中 | 0 | 2 | 0% |
| Phase-5: PromptX集成 | ⏳ 计划中 | 0 | 2 | 0% |
| Phase-6: AI角色系统 | ⏳ 计划中 | 0 | 2 | 0% |
| Phase-7: 集成测试 | ⏳ 计划中 | 0 | 3 | 0% |

**总体进度**: 14/23 任务完成 (60.9%)

## 当前优先级

**🔥 立即执行**: Task 3-2 Gemini API配置和连接测试
**📋 后续任务**: Task 3-3 → Phase-4 → Phase-5 → Phase-6 → Phase-7

## 风险提示

⚠️ **重要**: 严格按照现有workflow.json执行，不得修改已完成的前端代码结构
⚠️ **关键**: Gemini API Key需要保密处理，仅存储在服务器端环境变量中
